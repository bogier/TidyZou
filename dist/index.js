(()=>{var ve=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var mt=ve(()=>{(function(){let t=window.screen&&window.screen.width||window.innerWidth||1024,n=window.screen&&window.screen.height||window.innerHeight||768,s=Math.min(t,n),a={width:t,height:n,isSmallPhone:s<=380,isPhone:s>380&&s<=480,isTablet:s>480&&s<=900,isDesktop:s>900};window.DEVICE_PROFILE=a;let r=document.documentElement;a.isSmallPhone?r.classList.add("device-small-phone","device-phone"):a.isPhone?r.classList.add("device-phone"):a.isTablet?r.classList.add("device-tablet"):r.classList.add("device-desktop")})();var Q=1,q="TIDYZOU_SCHEMA_VERSION",Z="children";function ke(){let e=localStorage.getItem(Z),t;try{t=e?JSON.parse(e):[]}catch(r){console.warn("[TidyZou] JSON children corrompu, reset \u2192 []",r),t=[]}let n=parseInt(localStorage.getItem(q)||"0",10);Number.isNaN(n)&&(n=0);let{migratedChildren:s,newVersion:a}=X(t,n);return localStorage.setItem(Z,JSON.stringify(s)),localStorage.setItem(q,String(a)),s}function Ee(e){return Array.isArray(e)?e:[]}var be={0:Ee};function X(e,t){let n=t,s=e;for(;n<Q;){let a=be[n];if(typeof a!="function"){console.warn(`[TidyZou] Aucune migration d\xE9finie pour passer de v${n} \xE0 v${n+1}. Les donn\xE9es peuvent \xEAtre incoh\xE9rentes.`);break}console.log(`[TidyZou] Migration sch\xE9ma v${n} \u2192 v${n+1}`),s=a(s),n++}return{migratedChildren:s,newVersion:n}}var m=ke(),E=0;function b(){return!m||!m.length||E<0||E>=m.length?null:m[E]}function y(){localStorage.setItem(Z,JSON.stringify(m)),localStorage.setItem(q,String(Q))}function ce(){localStorage.getItem("purged")!=="1"&&(m.length||(m=[{settings:{childName:"Bertrand",rewardLow:"Petit cadeau",rewardHigh:"Grande sortie",thresholdLow:30,thresholdHigh:50},tasks:[{name:"Brosser les dents",weights:[1,1,1,1,1,0,0]},{name:"Devoirs",weights:[1,1,1,1,1,0,0]}],notes:{},history:[],rewardsByWeek:{}}],y()))}ce();function se(e){return e.toLocaleDateString("fr-FR",{day:"2-digit",month:"2-digit"})}function Le(e){return e.toLocaleDateString("fr-FR",{month:"long",year:"numeric"})}function ee(e){e=new Date(e);let t=e.getDay(),n=e.getDate()-t+(t==0?-6:1);return new Date(e.setDate(n))}function P(e){e=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())),e.setUTCDate(e.getUTCDate()+4-(e.getUTCDay()||7));let t=new Date(Date.UTC(e.getUTCFullYear(),0,1));return Math.ceil(((e-t)/864e5+1)/7)}function Ie(e){let t=new Date(e);return t.setDate(e.getDate()+6),t}var v=new Date;function te(){let e=ee(v),t=Ie(e);return{num:P(e),annee:e.getFullYear(),lundi:se(e),dim:se(t),m:e,s:t}}function A(){let e=te();return`${e.num}-${e.annee}`}function Ce(){let e=new Date;return`${P(e)}-${e.getFullYear()}`}function le(){let e=document.getElementById("vue-recompenses"),t=document.getElementById("customWeek");e&&e.classList.contains("active")&&t&&(t.value=A())}function U(e){v.setDate(v.getDate()+e*7),B(),le()}function Ae(){document.querySelectorAll(".avatar").forEach(e=>{e.onerror=()=>{e.onerror=null,e.src="img/default.png"}})}function Be(){let e=document.getElementById("childrenList");e&&(e.innerHTML="",m.forEach((t,n)=>{let s=n===E?" active":"",a=(t.settings.childName||"Enfant").trim();e.insertAdjacentHTML("beforeend",`
      <li class="child-accordion${s}" data-idx="${n}">
        <h3>
          <span><img src="${t.settings.avatar||"img/default.png"}" class="avatar" alt=""> ${a}</span>
          <span class="arrow">\u25BC</span>
        </h3>
		
        <ul class="options">
		<li onclick="openNameAvatar(${n})" class="menu-nom-avatar">
		<img src="appli/NomEtAvatars.png" alt="Nom et avatar" class="icon-nom-avatar">
		  <span>Nom et avatar</span>
		</li>
		<li onclick="openTaskManager(${n})" class="menu-taches">
		  <img src="appli/taches.png" alt="T\xE2ches" class="icon-taches">
		  <span>T\xE2ches</span>
		</li>
		<li onclick="openRewardsManager(${n})" class="menu-recompenses">
		  <img src="appli/recompenses.png" alt="R\xE9compenses" class="icon-recompenses">
		  <span>R\xE9compenses</span>
		</li>
		<li onclick="exportChild(${n})" class="menu-exporter">
		  <img src="appli/exporter.png" alt="Exporter un enfant" class="icon-exporter">
		  <span>Exporter cet enfant</span>
		</li>
		<li onclick="deleteChild(${n})" class="menu-supprimer">
		  <img src="appli/SupprimerEnfant.png" alt="Supprimer un enfant" class="icon-supprimer">
		  <span>Supprimer cet enfant</span>
		</li>
		<li onclick="selectChild(${n}); showView('vue-jour')" class="menu-suivi-taches">
		  <img src="appli/taches.png" alt="Suivi des t\xE2ches" class="icon-suivi-taches">
		  <span>Suivi des t\xE2ches</span>
		</li>
		<li onclick="selectChild(${n}); showView('vue-resultats')" class="menu-resultats">
		  <img src="appli/Resultats.png" alt="R\xE9sultats" class="icon-resultats">
		  <span>R\xE9sultats</span>
		</li>

		  
        </ul>
      </li>`)}),Ae())}function F(e){E=e,y(),B()}function $e(){let e={settings:{childName:"",avatar:null,age:null,gender:"non-defini",rewardLow:"",rewardHigh:"",thresholdLow:30,thresholdHigh:50},tasks:[],notes:{},history:[],rewardsByWeek:{}};m.push(e),y(),E=m.length-1,pe(E),O()}function xe(e){confirm("Supprimer cet enfant ?")&&(m.splice(e,1),E=Math.min(E,m.length-1),y(),B(),C("vue-accueil"))}function Te(e){let t=new Blob([JSON.stringify(m[e],null,2)],{type:"application/json"}),n=URL.createObjectURL(t),s=document.createElement("a");s.href=n,s.download=`${m[e].settings.childName||"enfant"}.json`,s.click(),URL.revokeObjectURL(n)}function Me(){if(!m||!m.length){alert("Aucune donn\xE9e \xE0 exporter (aucun enfant trouv\xE9).");return}let e={schema:"TidyZou-export",version:Q,exportedAt:new Date().toISOString(),data:{children:m,currentChild:E}},t=JSON.stringify(e,null,2),n=new Date,s=c=>String(c).padStart(2,"0"),a="TidyZou-export-"+n.getFullYear()+s(n.getMonth()+1)+s(n.getDate())+"-"+s(n.getHours())+s(n.getMinutes())+".json",r=new Blob([t],{type:"application/json"}),o=URL.createObjectURL(r),i=document.createElement("a");i.href=o,i.download=a,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(o),alert(`\u2705 Fichier export\xE9.
Vous pouvez maintenant le communiquer (email, message, cl\xE9 USB\u2026) vers un autre appareil.`)}function de(e){let t;try{t=JSON.parse(e)}catch(n){return alert("\u274C Fichier invalide : JSON non lisible."),null}if(t&&t.schema==="TidyZou-export"){let n=t.data||{};return Array.isArray(n.children)?{children:n.children,currentChild:typeof n.currentChild=="number"?n.currentChild:0,version:typeof t.version=="number"?t.version:0}:(alert("\u274C Fichier TidyZou invalide : 'data.children' manquant ou incorrect."),null)}return Array.isArray(t.children)?{children:t.children,currentChild:0,version:0}:(alert("\u274C Ce fichier ne semble pas \xEAtre un export TidyZou valide."),null)}function Se(e){let t=e.target.files[0];if(e.target.value="",!t)return;let n=new FileReader;n.onload=s=>{let a=de(s.target.result);if(!a)return;let r=a.children||[];if(!r.length){alert("Aucun enfant dans le fichier \xE0 fusionner.");return}let o=typeof a.version=="number"?a.version:0,{migratedChildren:i}=X(r,o);if(r=i,!confirm(`Les donn\xE9es du fichier vont \xEAtre fusionn\xE9es avec vos enfants existants.
- M\xEAme pr\xE9nom (et \xE2ge/genre compatibles) \u2192 donn\xE9es fusionn\xE9es.
- Autres enfants \u2192 ajout\xE9s \xE0 la suite.

Aucune donn\xE9e actuelle ne sera supprim\xE9e.
Continuer ?`))return;m||(m=[]);let c=0,l=0;r.forEach(f=>{let d=Ke(f);d===-1?(m.push(f),l++):(m[d]=tt(m[d],f),c++)}),y(),B(),alert(`\u2705 Fusion termin\xE9e.
- ${c} enfant(s) fusionn\xE9(s)
- ${l} enfant(s) ajout\xE9(s)`)},n.readAsText(t)}function De(e){let t=e.target.files[0];if(e.target.value="",!t)return;let n=new FileReader;n.onload=s=>{let a=de(s.target.result);if(!a||!confirm(`\u26A0\uFE0F Ceci va remplacer TOUTES les donn\xE9es actuelles (tous les enfants, t\xE2ches, historique).
Continuer ?`))return;m=a.children||[];let r=typeof a.version=="number"?a.version:0,{migratedChildren:o,newVersion:i}=X(m,r);m=o,E=a.currentChild||0,localStorage.setItem(q,String(i)),y(),E=Math.min(E,Math.max(m.length-1,0)),B(),C("vue-accueil"),alert(`\u2705 Import termin\xE9.
Toutes les donn\xE9es ont \xE9t\xE9 remplac\xE9es par celles du fichier.`)},n.readAsText(t)}function Ne(e){let t=e.target.files[0];if(!t)return;let n=new FileReader;n.onload=()=>{var s;try{let a=JSON.parse(n.result);if(!((s=a==null?void 0:a.settings)!=null&&s.childName)){alert("Fichier invalide");return}m.push(a),y(),E=m.length-1,B()}catch(a){alert("JSON invalide")}},n.readAsText(t),e.target.value=""}function Re(){let e={settings:{childName:"Exemple",rewardLow:"Choisir un dessin anim\xE9",rewardHigh:"Sortie parc",thresholdLow:40,thresholdHigh:70},tasks:[{name:"Ranger la chambre",weights:[1,1,1,1,1,0,0]},{name:"Lire 10 min",weights:[1,1,1,1,1,0,0]}],notes:{},history:[]};m.push(e),y(),E=m.length-1,B()}function K(){confirm("\u267B\uFE0F R\xE9initialiser TOUTES les donn\xE9es de CHAQUE enfant (nom, avatar, \xE2ge, genre, r\xE9compenses, seuils, t\xE2ches, notes, historique) ?")&&(m=m.map(e=>({settings:{childName:"",avatar:null,avatarName:void 0,age:null,gender:"non-defini",rewardLow:"",rewardHigh:"",thresholdLow:30,thresholdHigh:50},tasks:[],notes:{},history:[]})),y(),B(),alert("\u2705 Tous les enfants ont \xE9t\xE9 enti\xE8rement r\xE9initialis\xE9s."))}function G(){confirm("Tout supprimer ?")&&(localStorage.clear(),sessionStorage.clear(),localStorage.setItem("purged","1"),m=[],E=0,B(),alert("\u{1F5D1}\uFE0F Tous les enfants ont \xE9t\xE9 supprim\xE9s !"),C("vue-accueil"))}function Fe(){let{m:e,s:t}=te(),n=r=>r.toLocaleDateString("fr-FR",{day:"2-digit",month:"long"}),s=document.getElementById("weekTitle");s&&(s.textContent=`${n(e)} \u2013 ${n(t)}`);let a=document.getElementById("monthTitle");a&&(a.textContent=Le(new Date(v.getFullYear(),v.getMonth(),1)))}function ue(){let e=b();if(!e)return;let t=e.settings.childName||"Mon enfant",n=document.getElementById("currentChild_day"),s=document.getElementById("currentChild_month"),a=document.getElementById("currentChild_tasks"),r=document.getElementById("currentChild_rewards_results"),o=document.getElementById("currentChild_rewards");n&&(n.textContent=t),s&&(s.textContent=t),a&&(a.textContent=t),o&&(o.textContent=t),r&&(r.textContent=t);let i=document.getElementById("childTitle");i&&(i.textContent="R\xE9sultats - "+t)}function me(){let e=new Date(v),t={weekday:"long"},n=e.toLocaleDateString("fr-FR",t);return n.charAt(0).toUpperCase()+n.slice(1)}function He(){let e=document.getElementById("currentDayLabel");e&&(e.textContent=me())}function x(e,t){var a;e.notes||(e.notes={});let n=((a=e.tasks)==null?void 0:a.length)||0;Array.isArray(e.notes[t])||(e.notes[t]=[]);let s=e.notes[t];for(let r=0;r<s.length;r++)(!Array.isArray(s[r])||s[r].length!==7)&&(s[r]=[0,0,0,0,0,0,0]);for(;s.length<n;)s.push([0,0,0,0,0,0,0]);for(;s.length>n;)s.pop()}function J(){let e=document.querySelector("#vue-jour table tbody");if(!e)return;e.innerHTML="";let t=b(),n=A();x(t,n);let s=new Date(v),a=s.getDay()===0?6:s.getDay()-1;if(!t.tasks.length){e.innerHTML='<tr><td colspan="2">\u26A0\uFE0F Aucune t\xE2che d\xE9finie</td></tr>';return}t.tasks.forEach((r,o)=>{var f,d,u;let i=(u=(d=(f=t.notes[n])==null?void 0:f[o])==null?void 0:d[a])!=null?u:0,c=n!==Ce()?"disabled":"",l=`t${o}d${a}`;e.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${r.name}</td>
        <td class="rating-cell">
          <input type="radio" id="${l}v0" name="${l}" data-task="${o}" data-day="${a}" value="0" ${i==0?"checked":""} ${c}>
          <label for="${l}v0">\u{1F534}</label>
          <input type="radio" id="${l}v05" name="${l}" data-task="${o}" data-day="${a}" value="0.5" ${i==.5?"checked":""} ${c}>
          <label for="${l}v05">\uFE0F\u{1F7E1}</label>
          <input type="radio" id="${l}v1" name="${l}" data-task="${o}" data-day="${a}" value="1" ${i==1?"checked":""} ${c}>
          <label for="${l}v1">\u{1F7E2}</label>
        </td>
      </tr>`)}),e.querySelectorAll("input[type=radio]").forEach(r=>{r.addEventListener("change",()=>{We(),H(),oe(r)}),oe(r)})}function fe(){let e=document.querySelector("#vue-mois .calendar-month");if(!e)return;e.innerHTML="";let t=b(),n=A();x(t,n);let s=v.getFullYear(),a=v.getMonth(),r=new Date(s,a+1,0).getDate(),o=new Date;o.setHours(0,0,0,0);for(let i=1;i<=r;i++){let c=document.createElement("div");c.className="calendar-cell";let l=new Date(s,a,i);l.setHours(0,0,0,0),c.innerHTML=`<span class="date">${i}</span>`;let f=`${P(l)}-${l.getFullYear()}`;x(t,f);let d=l.getDay()===0?6:l.getDay()-1,u=0,g=0;(t.tasks||[]).forEach((h,k)=>{var w,$,L;let I=(L=($=(w=t.notes[f])==null?void 0:w[k])==null?void 0:$[d])!=null?L:0;u+=1,g+=parseFloat(I)||0});let p=u?g/u*100:0;if(p===100?(c.style.background="#e8f5e9",c.style.border="2px solid #aaa"):p>0?(c.style.background="#fff4e5",c.style.border="2px solid #aaa"):(c.style.background="#fdecea",c.style.border="2px solid #aaa"),l.getTime()===o.getTime()?c.classList.add("today"):l<o&&c.classList.add("past"),u>0){let h=document.createElement("div");h.className="percent",h.textContent=`${p.toFixed(0)}%`,c.appendChild(h)}e.appendChild(c)}}function We(){let e=A(),t=b();x(t,e),document.querySelectorAll("#vue-jour input[type=radio]:checked").forEach(n=>{let s=n.dataset.task,a=n.dataset.day;s!==void 0&&a!==void 0&&(t.notes[e][s][a]=parseFloat(n.value))}),y(),fe(),J(),W(),D(),H()}function je(e,t){var c,l,f,d,u,g,p;let n=Number((l=(c=e==null?void 0:e.settings)==null?void 0:c.thresholdLow)!=null?l:30),s=Number((d=(f=e==null?void 0:e.settings)==null?void 0:f.thresholdHigh)!=null?d:50),a=((u=e==null?void 0:e.settings)==null?void 0:u.rewardLow)||"",r=((g=e==null?void 0:e.settings)==null?void 0:g.rewardHigh)||"",o=h=>String(h!=null?h:"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,""),i=(p=e==null?void 0:e.rewardsByWeek)==null?void 0:p[t];if(Array.isArray(i)&&i.length)for(let h of i){let k=o(h.palier);(k==="1"||k==="p1"||k==="palier1")&&(h!=null&&h.reward)&&(a=h.reward),(k==="2"||k==="p2"||k==="palier2")&&(h!=null&&h.reward)&&(r=h.reward)}return{t1:n,r1:a,t2:s,r2:r}}function Pe(e,t){var o,i;let n=document.getElementById("rewardBannerW1"),s=document.getElementById("rewardBannerW2");n&&(n.className="reward-banner hidden",n.innerHTML=""),s&&(s.className="reward-banner hidden",s.innerHTML="");let a=e>=t.t1&&!!((o=t.r1)!=null&&o.trim()),r=e>=t.t2&&!!((i=t.r2)!=null&&i.trim());a&&n&&(n.innerHTML=`<span class="badge">Palier 1</span> ${t.r1} <span style="opacity:.6;font-weight:600">(${e.toFixed(1)}%)</span>`,n.classList.remove("hidden"),n.classList.add("palier-1","pop"),setTimeout(()=>n.classList.remove("pop"),300)),r&&s&&(s.innerHTML=`<span class="badge">Palier 2</span> ${t.r2} <span style="opacity:.6;font-weight:600">(${e.toFixed(1)}%)</span>`,s.classList.remove("hidden"),s.classList.add("palier-2","pop"),setTimeout(()=>s.classList.remove("pop"),300))}function H(){var I;let e=b(),t=A();x(e,t);let n=e.notes[t]||[],s=0,a=0;(e.tasks||[]).forEach((w,$)=>{(n[$]||[]).forEach((L=0)=>{s+=1,a+=parseFloat(L)||0})});let r=s?a/s*100:0,o=document.getElementById("resultat");o&&(o.textContent=`\u2705 ${a.toFixed(1)}/${s} pts (${r.toFixed(1)}%)`);let i=document.getElementById("progressBar");i&&(i.style.width=Math.min(100,Math.max(0,r))+"%");let c=document.getElementById("resultatJour");c&&(c.textContent=`\u2705 ${a.toFixed(1)}/${s} pts (${r.toFixed(1)}%)`);let l=document.getElementById("progressBarJour");l&&(l.style.width=Math.min(100,Math.max(0,r))+"%");let f=A(),d="\u274C Aucune r\xE9compense",u="-",g=(I=e.rewardsByWeek)==null?void 0:I[f];Array.isArray(g)&&g.length>0?(d=g.map(w=>w.reward).join(" + "),u=g.map(w=>w.palier).join(", ")):r>=(e.settings.thresholdHigh||50)&&e.settings.rewardHigh?(d=`${e.settings.rewardHigh}`,u="Palier 2"):r>=(e.settings.thresholdLow||30)&&e.settings.rewardLow&&(d=`${e.settings.rewardLow}`,u="Palier 1"),e.history=e.history||[];let p=e.history.find(w=>w.week===f);p?(p.pct=r.toFixed(1),p.reward=d,p.palier=u):e.history.push({week:f,pct:r.toFixed(1),reward:d,palier:u}),y();let h=A(),k=je(e,h);Pe(r,k),Ye(),ue()}function W(){let e=ge(),t=document.getElementById("progressBarJournee"),n=document.getElementById("resultatJournee");t&&(t.style.width=e+"%"),n&&(n.textContent=e+"%")}function ge(){try{let e=b(),t=A();x(e,t);let n=new Date(v),s=n.getDay()===0?6:n.getDay()-1,a=0,r=0;return(e.tasks||[]).forEach((o,i)=>{var l,f;let c=(f=(l=e.notes[t])==null?void 0:l[i])==null?void 0:f[s];c!=null&&(a+=1,r+=parseFloat(c)||0)}),a===0?0:Math.round(r/a*100)}catch(e){return 0}}function Oe(){let e=document.getElementById("vue-jour");e&&e.addEventListener("change",t=>{t.target&&t.target.matches('input[type="radio"]')&&setTimeout(W,0)})}function ae(e,t,n,s){let a=(s-90)*Math.PI/180;return{x:e+n*Math.cos(a),y:t+n*Math.sin(a)}}function re(e,t,n,s,a){let r=ae(e,t,n,a),o=ae(e,t,n,s),i=a-s<=180?"0":"1";return`M ${r.x} ${r.y} A ${n} ${n} 0 ${i} 0 ${o.x} ${o.y}`}function Ue(){let e=b(),t=A();x(e,t);let n=0,s=0;return(e.tasks||[]).forEach((a,r)=>{var o;(((o=e.notes[t])==null?void 0:o[r])||[]).forEach(i=>{n+=1,s+=parseFloat(i)||0})}),n?Math.round(s/n*100):0}function qe(){let e=b(),t=v.getFullYear(),n=v.getMonth(),s=new Date(t,n+1,0).getDate(),a=0,r=0;for(let o=1;o<=s;o++){let i=new Date(t,n,o),c=i.getDay()===0?6:i.getDay()-1,l=`${P(i)}-${i.getFullYear()}`;x(e,l),(e.tasks||[]).forEach((f,d)=>{var g,p;let u=(p=(g=e.notes[l])==null?void 0:g[d])==null?void 0:p[c];u!==void 0&&(a+=1,r+=parseFloat(u)||0)})}return a?Math.round(r/a*100):0}function ne(e,t){var n;e.notes||(e.notes={}),(!Array.isArray(e.notes[t])||e.notes[t].length!==(((n=e.tasks)==null?void 0:n.length)||0))&&(e.notes[t]=(e.tasks||[]).map(()=>[0,0,0,0,0,0,0]))}function Ve(e){let t=m[e];if(!t)return 0;let n=A();ne(t,n);let s=new Date(v),a=s.getDay()===0?6:s.getDay()-1,r=0,o=0;return(t.tasks||[]).forEach((i,c)=>{var f,d;let l=(d=(f=t.notes[n])==null?void 0:f[c])==null?void 0:d[a];l!==void 0&&(r+=1,o+=parseFloat(l)||0)}),r?Math.round(o/r*100):0}function Je(e){let t=m[e];if(!t)return 0;let n=A();ne(t,n);let s=0,a=0;return(t.tasks||[]).forEach((r,o)=>{var i;(((i=t.notes[n])==null?void 0:i[o])||[]).forEach(c=>{s+=1,a+=parseFloat(c)||0})}),s?Math.round(a/s*100):0}function _e(e){let t=m[e];if(!t)return 0;let n=v.getFullYear(),s=v.getMonth(),a=new Date(n,s+1,0).getDate(),r=0,o=0;for(let i=1;i<=a;i++){let c=new Date(n,s,i),l=c.getDay()===0?6:c.getDay()-1,f=`${P(c)}-${c.getFullYear()}`;ne(t,f),(t.tasks||[]).forEach((d,u)=>{var p,h;let g=(h=(p=t.notes[f])==null?void 0:p[u])==null?void 0:h[l];g!==void 0&&(r+=1,o+=parseFloat(g)||0)})}return r?Math.round(o/r*100):0}function Y(e,t,n,s){let a=document.getElementById(e);if(!a)return;a.innerHTML="";let r=Math.max(0,Math.min(1,t/100)),o=60+r*20,i=.5+r*(.25-.08);a.style.setProperty("--bg-size",o+"%"),a.style.setProperty("--bg-opacity",i.toFixed(2));let c=140,l=c/2,f=c/2,d=64,u=56,g=12,p=6,h=360/g,k=Math.floor(t/100*g),I=document.createElementNS("http://www.w3.org/2000/svg","svg");I.setAttribute("viewBox",`0 0 ${c} ${c}`);let w=document.createElementNS(I.namespaceURI,"circle");w.setAttribute("class","outer-ring"),w.setAttribute("cx",l),w.setAttribute("cy",f),w.setAttribute("r",d),I.appendChild(w);for(let L=0;L<g;L++){let N=L*h+p/2,_=(L+1)*h-p/2,S=document.createElementNS(I.namespaceURI,"path");S.setAttribute("d",re(l,f,u,N,_)),S.setAttribute("class","seg-bg"),I.appendChild(S)}for(let L=0;L<k;L++){let N=L*h+p/2,_=(L+1)*h-p/2,S=document.createElementNS(I.namespaceURI,"path");S.setAttribute("d",re(l,f,u,N,_)),S.setAttribute("class","seg-fill"),S.setAttribute("stroke",n),I.appendChild(S)}a.appendChild(I);let $=document.createElement("div");$.className="center",$.innerHTML=`
    <div class="badge">
      <div class="pct">${t}%</div>
      <div class="lbl">${s}</div>
    </div>`,a.appendChild($)}function D(){let e=ge(),t=Ue(),n=qe(),s=getComputedStyle(document.documentElement);Y("radial-jour",e,s.getPropertyValue("--color-jour").trim()||"#1e63d1","jour"),Y("radial-semaine",t,s.getPropertyValue("--color-semaine").trim()||"#2ecc71","semaine"),Y("radial-mois",n,s.getPropertyValue("--color-mois").trim()||"#8e44ad","mois")}function he(){let e=document.getElementById("homeHero"),t=document.getElementById("homeTitle"),n=document.getElementById("homeSubtitle"),s=document.getElementById("homeIllustration"),a=document.getElementById("homeChildren"),r=document.getElementById("homeWeekNav"),o=document.getElementById("homeWeekLabel");if(!e||!t||!a)return;if(a.innerHTML="",!(m&&m.length>0)){t.textContent="Bienvenue dans TidyZou",n&&(n.style.display=""),s&&(s.style.display=""),a.style.display="none",e.style.display="",r&&(r.style.display="none");return}let c=te(),l=c.num;t.textContent="Bilan semaine "+l,r&&(r.style.display="flex"),o&&(o.textContent=`Semaine ${l} (${c.lundi} \u2013 ${c.dim})`),n&&(n.style.display="none"),s&&(s.style.display="none"),e.style.display="",a.style.display="";let f=me();a.innerHTML="",m.forEach((d,u)=>{var $,L;let g=((($=d==null?void 0:d.settings)==null?void 0:$.childName)||"Mon enfant").trim(),p=((L=d==null?void 0:d.settings)==null?void 0:L.avatar)||"img/default.png",h=Ve(u),k=Je(u),I=_e(u),w=document.createElement("article");w.className="child-card",w.innerHTML=`
      <img class="card-avatar" src="${p}" alt="${g}">
      <div>
        <div class="card-title">${g}</div>

        <div class="hc-bars">
          <div class="hc-row">
            <div class="hc-label">${f}</div>
            <div class="hc-bar"><div class="hc-fill day"   style="width:${h}%"></div></div>
            <div class="hc-pct">${h}%</div>
          </div>

          <div class="hc-row">
            <div class="hc-label">Semaine</div>
            <div class="hc-bar"><div class="hc-fill week"  style="width:${k}%"></div></div>
            <div class="hc-pct">${k}%</div>
          </div>
          <div class="hc-row">
            <div class="hc-label">Mois</div>
            <div class="hc-bar"><div class="hc-fill month" style="width:${I}%"></div></div>
            <div class="hc-pct">${I}%</div>
          </div>
        </div>
      </div>
    `,w.setAttribute("role","button"),w.setAttribute("tabindex","0"),w.setAttribute("title",`Ouvrir le suivi de ${g}`),w.addEventListener("click",()=>{F(u),C("vue-jour")}),w.addEventListener("keydown",N=>{(N.key==="Enter"||N.key===" ")&&(N.preventDefault(),F(u),C("vue-jour"))}),a.appendChild(w)})}function Ye(){let e=document.getElementById("historiqueBody");if(!e)return;e.innerHTML="";let t=b();if(!t)return;let n=t.history||[],s=0,a=0;if(n.forEach(r=>{let o=parseFloat(r.pct)||0;o!==0&&(s+=o,a++,e.insertAdjacentHTML("beforeend",`<tr>
         <td>${r.week}</td>
         <td>${o}%</td>
         <td>${r.reward||""}</td>
       </tr>`))}),a>0){let r=(s/a).toFixed(1);e.insertAdjacentHTML("beforeend",`<tr class="row-average">
         <td>Moyenne</td>
         <td>${r}%</td>
         <td></td>
       </tr>`)}}var T=document.getElementById("sidebar"),M=document.getElementById("overlay"),z=document.querySelector(".menu-btn");function ze(){T==null||T.classList.add("show"),M==null||M.classList.add("show")}function O(){T==null||T.classList.remove("show"),M==null||M.classList.remove("show")}z==null||z.addEventListener("click",()=>{T!=null&&T.classList.contains("show")?O():ze()});M==null||M.addEventListener("click",O);var ie;(ie=document.querySelector(".nav-list li:first-child"))==null||ie.addEventListener("click",O);document.addEventListener("click",e=>{let t=e.target.closest(".child-accordion > h3");t&&t.parentElement.classList.toggle("open")});function C(e){var t;document.querySelectorAll(".view").forEach(n=>n.classList.remove("active")),(t=document.getElementById(e))==null||t.classList.add("active"),document.querySelectorAll(".tabs button").forEach(n=>n.classList.remove("active")),e==="vue-jour"?document.querySelectorAll(".tabs button").forEach(n=>{n.textContent.trim()==="Jour"&&n.classList.add("active")}):e==="vue-mois"&&document.querySelectorAll(".tabs button").forEach(n=>{n.textContent.trim()==="Mois"&&n.classList.add("active")}),e==="vue-accueil"&&he(),O()}function Ze(e,t){document.querySelectorAll(".tabs button").forEach(n=>n.classList.remove("active")),e.classList.add("active"),C(t)}window.showView=C;window.switchTab=Ze;function B(){var e,t,n,s;if(Be(),he(),!m||m.length===0){C("vue-accueil"),(e=document.getElementById("btnResetChildren"))==null||e.addEventListener("click",K),(t=document.getElementById("btnPurgeAll"))==null||t.addEventListener("click",G);return}Fe(),ue(),He(),J(),W(),fe(),H(),D(),le(),(n=document.getElementById("btnResetChildren"))==null||n.addEventListener("click",K),(s=document.getElementById("btnPurgeAll"))==null||s.addEventListener("click",G),document.querySelector(".view.active")||C("vue-accueil")}function pe(e){F(e),C("vue-nom-avatar");let t=b(),n=document.getElementById("inputChildName");n&&(n.value=t.settings.childName||"",n.oninput=()=>{t.settings.childName=n.value.trim()||"Mon enfant",y(),B()});let s=document.getElementById("avatarPreview"),a=document.getElementById("avatarFileName");console.log("avatarPreview trouv\xE9 ?",s),t.settings.avatar?(console.log("Avatar trouv\xE9 dans localStorage :",t.settings.avatar.substring(0,50)),s.src=t.settings.avatar,a.textContent=t.settings.avatarName||"Image import\xE9e"):(console.log("Pas d\u2019avatar \u2192 utilisation du d\xE9faut"),s.src="img/default.png",a.textContent="Avatar par d\xE9faut");let r=document.getElementById("inputChildAge");r&&(r.value=t.settings.age||"",r.oninput=()=>{t.settings.age=parseInt(r.value)||null,y()}),document.querySelectorAll("input[name='childGender']").forEach(i=>{i.checked=(t.settings.gender||"non-defini")===i.value,i.onchange=()=>{i.checked&&(t.settings.gender=i.value,y())}});let o=document.getElementById("inputAvatar");o&&(o.value="",o.onchange=i=>{let c=i.target.files[0];if(!c)return;let l=5*1024*1024;if(c.size>l){alert("\u26A0\uFE0F L\u2019image est trop lourde (max 5 Mo). Choisis une image plus l\xE9g\xE8re.");return}let f=new FileReader;f.onload=d=>{let u=new Image;u.onload=()=>{let g=document.createElement("canvas"),p=g.getContext("2d"),h=200;g.width=h,g.height=h,p.drawImage(u,0,0,h,h);let k=g.toDataURL("image/png",.8);s.src=k,m[E].settings.avatar=k,m[E].settings.avatarName=c.name,a.textContent=c.name,y(),B(),console.log("\u2705 Avatar compress\xE9 et sauvegard\xE9",k.substring(0,50))},u.src=d.target.result},f.readAsDataURL(c)}),C("vue-nom-avatar")}function ye(e){e.notes||(e.notes={});for(let t of Object.keys(e.notes))e.notes[t].push([0,0,0,0,0,0,0])}function V(e){return(e||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim()}function Ke(e){var a,r;if(!e||!e.settings)return-1;let t=V(e.settings.childName||"");if(!t)return-1;let n=(a=e.settings.age)!=null?a:null,s=e.settings.gender||null;for(let o=0;o<m.length;o++){let i=m[o];if(!i||!i.settings)continue;let c=V(i.settings.childName||"");if(!c||c!==t)continue;let l=(r=i.settings.age)!=null?r:null,f=i.settings.gender||null;if(!(n!==null&&l!==null&&n!==l)&&!(s&&f&&s!==f))return o}return-1}function Ge(e,t){if(e.settings||(e.settings={}),!t.settings)return;let n=e.settings,s=t.settings;!n.childName&&s.childName&&(n.childName=s.childName),!n.avatar&&s.avatar&&(n.avatar=s.avatar,s.avatarName&&(n.avatarName=s.avatarName)),(n.age===null||n.age===void 0)&&s.age!==null&&s.age!==void 0&&(n.age=s.age),!n.gender&&s.gender&&(n.gender=s.gender),!n.rewardLow&&s.rewardLow&&(n.rewardLow=s.rewardLow),!n.rewardHigh&&s.rewardHigh&&(n.rewardHigh=s.rewardHigh),(n.thresholdLow===void 0||n.thresholdLow===null)&&s.thresholdLow!==void 0&&(n.thresholdLow=s.thresholdLow),(n.thresholdHigh===void 0||n.thresholdHigh===null)&&s.thresholdHigh!==void 0&&(n.thresholdHigh=s.thresholdHigh)}function Qe(e,t){if(t.rewardsByWeek){e.rewardsByWeek||(e.rewardsByWeek={});for(let[n,s]of Object.entries(t.rewardsByWeek)){if(!Array.isArray(s)||!s.length)continue;Array.isArray(e.rewardsByWeek[n])||(e.rewardsByWeek[n]=[]);let a=e.rewardsByWeek[n];s.forEach(r=>{if(!r)return;let o=(r.reward||"").trim(),i=(r.palier||"").trim();if(!o)return;a.some(l=>(l.reward||"").trim()===o&&(l.palier||"").trim()===i)||a.push({reward:o,palier:i})})}}}function Xe(e,t){if(!t.history||!Array.isArray(t.history))return;(!e.history||!Array.isArray(e.history))&&(e.history=[]);let n=new Set(e.history.map(s=>s.week));t.history.forEach(s=>{!s||!s.week||n.has(s.week)||(e.history.push(s),n.add(s.week))})}function et(e,t){e.tasks||(e.tasks=[]),e.notes||(e.notes={}),t.tasks||(t.tasks=[]),t.notes||(t.notes={});let n=e.tasks,s=t.tasks,a={};n.forEach((o,i)=>{let c=V(o.name||"");c&&(a[c]=i)});let r=[];s.forEach((o,i)=>{let c=V(o.name||"");if(c)if(c in a)r[i]=a[c];else{let l=n.length;n.push({name:o.name,weights:Array.isArray(o.weights)?o.weights.slice():[1,1,1,1,1,0,0]}),ye(e),a[c]=l,r[i]=l}});for(let[o,i]of Object.entries(t.notes)){if(!Array.isArray(i))continue;x(e,o);let c=e.notes[o];i.forEach((l,f)=>{let d=r[f];if(d!=null&&!(!Array.isArray(l)||l.length!==7)){(!Array.isArray(c[d])||c[d].length!==7)&&(c[d]=[0,0,0,0,0,0,0]);for(let u=0;u<7;u++){let g=parseFloat(c[d][u])||0,p=parseFloat(l[u])||0,h=Math.max(g,p);c[d][u]=h}}})}}function tt(e,t){!e||!t||(Ge(e,t),et(e,t),Qe(e,t),Xe(e,t))}function nt(e){F(e),we(),C("vue-taches")}function we(){var s;let e=document.getElementById("taskList"),t=b();if(!e)return;let n=document.getElementById("currentChild_tasks");n&&(n.textContent=((s=t==null?void 0:t.settings)==null?void 0:s.childName)||"Mon enfant"),e.innerHTML="",t.tasks.forEach((a,r)=>{e.insertAdjacentHTML("beforeend",`
      <li>
        ${a.name}
        <span>
          <button onclick="moveTask(${r},-1)">\u2B06\uFE0F</button>
          <button onclick="moveTask(${r},1)">\u2B07\uFE0F</button>
          <button onclick="removeTask(${r})">\u{1F5D1}\uFE0F</button>
        </span>
      </li>`)})}function st(){let e=document.getElementById("newTaskName");if(!e)return;let t=e.value.trim();if(!t)return;let n=b();n.tasks.push({name:t,weights:[1,1,1,1,1,0,0]}),ye(n),x(n,A()),y(),C("vue-taches"),we(),e.value="",requestAnimationFrame(()=>{let s=document.getElementById("taskList"),a=s==null?void 0:s.lastElementChild;a&&(a.scrollIntoView({behavior:"smooth",block:"end"}),a.classList.add("added"),setTimeout(()=>a.classList.remove("added"),900)),e==null||e.focus()})}function oe(e){let t=e.nextElementSibling;t&&(t.style.opacity="0.4",t.style.background="transparent",t.style.border="2px solid transparent",e.checked&&(t.style.opacity="1",t.style.border="2px solid #aaa",e.value==="0"&&(t.style.background="#fdecea"),e.value==="0.5"&&(t.style.background="#fff4e5"),e.value==="1"&&(t.style.background="#e8f5e9")))}function at(){var d;let e=b(),t=document.getElementById("customWeek"),n=t?t.value.trim():"",s=document.getElementById("customReward"),a=s?s.value.trim():"",r=(d=document.getElementById("customPalier"))==null?void 0:d.value;if(!n||!a){alert("Veuillez saisir la semaine et la r\xE9compense.");return}let o=A(),c=(u=>{let g=String(u||"").toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"");return g==="1"||g==="p1"||g==="palier1"?"Palier 1":g==="2"||g==="p2"||g==="palier2"?"Palier 2":"Palier 1"})(r);if(e.rewardsByWeek||(e.rewardsByWeek={}),Array.isArray(e.rewardsByWeek[o])||(e.rewardsByWeek[o]=[]),e.rewardsByWeek[o].some(u=>u.palier===c&&u.reward===a)){alert("Cette r\xE9compense existe d\xE9j\xE0 pour cette semaine et ce palier.");return}e.rewardsByWeek[o].push({reward:a,palier:c}),y(),j(),H();let f=document.getElementById("customReward");f&&(f.value=""),y(),j(),H(),document.getElementById("customReward").value="",y(),j(),document.getElementById("customReward").value=""}function j(){let e=b(),t=document.querySelector("#customRewardsTable tbody");if(t){t.innerHTML="";for(let[n,s]of Object.entries(e.rewardsByWeek||{}))s.forEach((a,r)=>{let o=document.createElement("tr");o.innerHTML=`
        <td>${n}</td>
        <td>${a.reward}</td>
        <td>${a.palier||"-"}</td>
        <td><button onclick="deleteWeeklyReward('${n}', ${r})">\u274C</button></td>
      `,t.appendChild(o)})}}function rt(e,t){var s;let n=b();(s=n.rewardsByWeek)!=null&&s[e]&&(n.rewardsByWeek[e].splice(t,1),n.rewardsByWeek[e].length===0&&delete n.rewardsByWeek[e],y(),j(),H())}function ot(e){F(e),C("vue-recompenses");let t=document.getElementById("customWeek");if(t){let i=A();t.value=i,t.placeholder=i,t.readOnly=!0,t.disabled=!0}j();let n=b(),s=document.getElementById("inputRewardLow"),a=document.getElementById("inputRewardHigh"),r=document.getElementById("inputThresholdLow"),o=document.getElementById("inputThresholdHigh");s&&(s.value=n.settings.rewardLow||"",s.oninput=()=>{n.settings.rewardLow=s.value.trim(),y()}),a&&(a.value=n.settings.rewardHigh||"",a.oninput=()=>{n.settings.rewardHigh=a.value.trim(),y()}),r&&(r.value=n.settings.thresholdLow||30,r.oninput=()=>{n.settings.thresholdLow=parseFloat(r.value)||0,y()}),o&&(o.value=n.settings.thresholdHigh||50,o.oninput=()=>{n.settings.thresholdHigh=parseFloat(o.value)||0,y()}),it()}function it(){let e=b(),t=document.getElementById("summaryThreshold1"),n=document.getElementById("summaryThreshold2"),s=document.getElementById("summaryReward1"),a=document.getElementById("summaryReward2");t.value=e.settings.thresholdLow||0,n.value=e.settings.thresholdHigh||0,s.value=e.settings.rewardLow||"",a.value=e.settings.rewardHigh||"",t.oninput=()=>{e.settings.thresholdLow=parseFloat(t.value)||0,y()},n.oninput=()=>{e.settings.thresholdHigh=parseFloat(n.value)||0,y()},s.oninput=()=>{e.settings.rewardLow=s.value.trim(),y()},a.oninput=()=>{e.settings.rewardHigh=a.value.trim(),y()}}function ct(){let e=b(),t=document.querySelector("#customRewardsTable tbody");if(!t)return;t.innerHTML="";let n=e.rewardsByWeek||{};for(let[s,a]of Object.entries(n))t.insertAdjacentHTML("beforeend",`
      <tr>
        <td>${s}</td>
        <td>${a.reward}</td>
        <td>${a.palier}</td>
        <td><button onclick="deleteWeeklyReward('${s}')">\u{1F5D1}\uFE0F</button></td>
      </tr>
    `)}function lt(e){let t=ee(e),n=Math.round((e-t)/(24*3600*1e3));return Math.max(0,Math.min(6,n))}function dt(e){let t=ee(v),n=new Date(t);n.setDate(t.getDate()+e),v=n,J(),W(),D(),typeof R=="function"&&R()}function R(){let e=document.getElementById("jour-selector");if(!e)return;let t=lt(v);e.querySelectorAll(".jour-btn").forEach(n=>{parseInt(n.getAttribute("data-day-idx"),10)===t?n.classList.add("active"):n.classList.remove("active")})}function ut(){let e=document.getElementById("jour-selector");e&&(e.addEventListener("click",t=>{let n=t.target.closest(".jour-btn");if(!n)return;let s=parseInt(n.getAttribute("data-day-idx"),10);Number.isNaN(s)||dt(s)}),R())}document.addEventListener("DOMContentLoaded",()=>{var n,s,a,r,o,i;ce(),B(),ut(),R(),C("vue-accueil"),(n=document.getElementById("btnPrev"))==null||n.addEventListener("click",()=>{U(-1),D()}),(s=document.getElementById("btnNext"))==null||s.addEventListener("click",()=>{U(1),D()}),(a=document.getElementById("homePrevWeek"))==null||a.addEventListener("click",()=>{U(-1)}),(r=document.getElementById("homeNextWeek"))==null||r.addEventListener("click",()=>{U(1)}),(o=document.getElementById("btnPrevMonth"))==null||o.addEventListener("click",()=>{v.setMonth(v.getMonth()-1),B(),D()}),(i=document.getElementById("btnNextMonth"))==null||i.addEventListener("click",()=>{v.setMonth(v.getMonth()+1),B(),D()}),Oe(),W();let e=J;window.majVueJour=function(){e.apply(this,arguments),W(),D(),typeof R=="function"&&R()};let t=document.getElementById("newTaskName");t&&t.addEventListener("keydown",c=>{c.key==="Enter"&&st()})});window.selectChild=F;window.openNameAvatar=pe;window.openTaskManager=nt;window.openRewardsManager=ot;window.exportChild=Te;window.deleteChild=xe;window.handleImportChild=Ne;window.importExample=Re;window.addChild=$e;window.resetAllChildren=K;window.purgeAll=G;window.addWeeklyReward=at;window.renderCustomRewards=ct;window.deleteWeeklyReward=rt;window.exportAllData=Me;window.handleImportAllReplace=De;window.handleImportAllMerge=Se});mt();})();

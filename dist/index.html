<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8"/>
  <title>TidyZou</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=yes"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <link rel="manifest" href="manifest.json"/>
  <link rel="stylesheet" href="style.css"/>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="apple-touch-icon" href="icons/icon-192.png">

</head>

<body>

  <!-- ================= HEADER ================= -->
  <header class="app-header">
    <button class="menu-btn" aria-label="Ouvrir le menu">&#9776;</button>
    <h1>TidyZou </h1>
	<img src="appli/TidyZouSmileTransparent.png" alt="TidyZou" class="sidebar-logo">
  </header>

<!-- ================= SIDEBAR ================= -->
<nav class="sidebar" id="sidebar">

<div class="sidebar-title">
  <h2>Espace TidyZou</h2>
  <img src="appli/TidyZouSmileTransparent.png" alt="TidyZou" class="sidebar-logo">
</div>

  <div class="sidebar-grabber"></div>

  <div class="sidebar-content">
    <ul class="nav-list">
      <li onclick="showView('vue-accueil')" class="menu-accueil">
        <img src="appli/accueil.PNG" alt="Accueil" class="icon-home">
        <span>Accueil</span>
      </li>

    </ul>

    <input id="importChildInput" type="file" accept="application/json" style="display:none" onchange="handleImportChild(event)">
	<input id="importAllReplaceInput"
       type="file"
       accept="application/json"
       style="display:none"
       onchange="handleImportAllReplace(event)">

    <input id="importAllMergeInput"
       type="file"
       accept="application/json"
       style="display:none"
       onchange="handleImportAllMerge(event)">

    <ul id="childrenList" class="nav-list children-list"></ul>
  </div>

  <!-- ======== FOOTER AVEC ACCORD√âON PARAM√àTRES ======== -->
  <div class="sidebar-footer">

    <!-- Accord√©on Param√®tres -->
    <li class="child-accordion" id="parametresAccordion">
      <h3>
        <span class="menu-parametres">
         <img src="appli/parameters.PNG" alt="Param√®tres" class="icon-parametres">
         <span>Param√®tres</span>
        </span>

        <span class="arrow">‚ñº</span>
      </h3>
      <ul class="options">
<li class="sidebar-link menu-ajouter" onclick="addChild()">
  <img src="appli/AjouterEnfant.PNG" alt="Ajouter un enfant" class="icon-ajouter">
  <span>Ajouter un enfant</span>
</li>
      
<li class="sidebar-link menu-importer" onclick="document.getElementById('importChildInput').click()">
  <img src="appli/importer.png" alt="Importer un enfant" class="icon-importer">
  <span>Importer un enfant</span>
</li>
<li class="sidebar-link menu-importer-exemple" onclick="importExample()">
  <img src="appli/importerExemple.png" alt="Importer l'exemple" class="icon-importer-exemple">
  <span>Importer l'exemple</span>
</li>
<li class="sidebar-link menu-exporter" onclick="exportAllData()">
  <img src="appli/exporter.png" alt="Exporter tout" class="icon-exporter">
  <span>Exporter tout</span>
</li>

<li class="sidebar-link menu-importer" onclick="document.getElementById('importAllReplaceInput').click()">
  <img src="appli/importer.png" alt="Importer tout et remplacer" class="icon-importer">
  <span>Importer tout - remplacer</span>
</li>

<li class="sidebar-link menu-importer" onclick="document.getElementById('importAllMergeInput').click()">
  <img src="appli/importer.png" alt="Importer tout et fusionner" class="icon-importer">
  <span>Importer tout - fusionner</span>
</li>

<li id="btnResetChildren" class="sidebar-link menu-reset">
  <img src="appli/ReinitialiserEnfants.PNG" alt="R√©initialiser les enfants" class="icon-reset">
  <span>R√©initialiser les enfants</span>
</li>
<li id="btnPurgeAll" class="sidebar-link menu-purge">
  <img src="appli/PurgeTotale.PNG" alt="Tout supprimer" class="icon-purge">
  <span>Tout supprimer</span>
</li>        
<li>
  <a href="about.html" class="sidebar-link menu-apropos">
    <img src="appli/Apropos.PNG" alt="√Ä propos" class="icon-apropos">
    <span>√Ä propos</span>
  </a>
</li>

<li>
  <a href="install.html" class="sidebar-link menu-installer">
    <img src="appli/InstallerApplication.PNG" alt="Installer l‚Äôapp" class="icon-installer">
    <span>Installer l‚Äôapp</span>
  </a>
</li>

      </ul>
    </li>

    <hr class="sidebar-separator">
  </div>
</nav>

<!-- Overlay -->
<div id="overlay"></div>


  <!-- Overlay -->
  <div id="overlay"></div>

  <!-- ================= VUES ================= -->
  
<main class="view active" id="vue-accueil">
  <!-- HERO d‚Äôaccueil / ou juste le titre en mode recap -->
  <section class="home-hero" id="homeHero">
    <h2 id="homeTitle">Bienvenue dans TidyZou </h2>
    <p id="homeSubtitle">Un jeu familial pour motiver les enfants √† accomplir leurs petites missions du quotidien, 
    suivre leurs progr√®s et gagner des r√©compenses amusantes !</p>
    <img src="img/TidyZou_transparent.webp" alt="Illustration d'accueil" class="home-illustration" id="homeIllustration">
  </section>

  <!-- Navigation semaine (bilan accueil) -->
  <div id="homeWeekNav" class="home-week-nav" style="display:none">
    <button id="homePrevWeek" class="week-nav-btn" type="button">‚¨Ö</button>
    <span id="homeWeekLabel" class="home-week-label">Semaine</span>
    <button id="homeNextWeek" class="week-nav-btn" type="button">‚û°</button>
  </div>

  <!-- Liste des enfants (affich√©e seulement si enfants > 0) -->
  <section class="home-children" id="homeChildren" style="display:none"></section>
</main>

  
  <main class="view" id="vue-jour">
    <div class="view-header">
      <div class="calendar">
        <button id="btnPrev">&lt;</button>
        <div class="calendar-title"><h2 id="weekTitle">1 Octobre 2025</h2></div>
        <button id="btnNext">&gt;</button>
      </div>

<div class="child-and-day">
  <img 
    src="appli/accueil.PNG" 
    alt="Accueil" 
    class="icon-home"
    onclick="showView('vue-accueil')"
  >
  <p class="current-child" id="currentChild_day">‚Äî</p>
</div>


 <!-- === BARRE DE S√âLECTION DU JOUR (vue-jour) === -->
    <div id="jour-selector" class="jour-selector">
      <button type="button" class="jour-btn" data-day-idx="0" title="Lundi">L</button>
      <button type="button" class="jour-btn" data-day-idx="1" title="Mardi">M</button>
      <button type="button" class="jour-btn" data-day-idx="2" title="Mercredi">M</button>
      <button type="button" class="jour-btn" data-day-idx="3" title="Jeudi">J</button>
      <button type="button" class="jour-btn" data-day-idx="4" title="Vendredi">V</button>
      <button type="button" class="jour-btn" data-day-idx="5" title="Samedi">S</button>
      <button type="button" class="jour-btn" data-day-idx="6" title="Dimanche">D</button>
    </div>
    <!-- === /BARRE DE S√âLECTION DU JOUR === -->

<div class="tabs">
  <button class="tab active" onclick="switchTab(this,'vue-jour')">Jour</button>
  <button class="tab" onclick="switchTab(this,'vue-mois')">Mois</button>
</div>

    </div>
    <div class="table-wrapper">
      <table>
        <thead><tr><th>T√¢che</th><th>Statut</th></tr></thead>
        <tbody></tbody>
      </table>
    </div>

<!-- ===== Indicateurs d'avancement (Jour + Semaine + Mois) ===== -->
<div class="radial-trio">
  <div class="radial" id="radial-jour"></div>
  <div class="radial" id="radial-semaine"></div>
  <div class="radial" id="radial-mois"></div>
</div>

<!-- ===== R√©compenses (SEMAINE) ===== -->
<div id="rewardBannerW1" class="reward-banner hidden" aria-live="polite"></div>
<div id="rewardBannerW2" class="reward-banner hidden" aria-live="polite"></div>

<!-- ===== / Indicateurs ===== -->
	
  </main>

  <main class="view" id="vue-mois">
    <div class="view-header">
      <div class="calendar">
        <button id="btnPrevMonth">&lt;</button>
        <div class="calendar-title"><h2 id="monthTitle">Mois</h2></div>
        <button id="btnNextMonth">&gt;</button>
      </div>
      <div class="child-and-month">
        <img src="appli/accueil.PNG" alt="Accueil" class="icon-home" onclick="showView('vue-accueil')" >
        <p class="current-child" id="currentChild_month">‚Äî</p>
      </div>	  
      <div class="tabs">
        <button class="tab" onclick="switchTab(this,'vue-jour')">Jour</button>
        <button class="tab active" onclick="switchTab(this,'vue-mois')">Mois</button>
      </div>
    </div>
    <div class="calendar-month"></div>
  </main>

<main class="view result-view" id="vue-resultats">

<div class="view-header">
  <button onclick="openMenu()" class="back-btn">‚¨Ö Retour</button>
  <h2>
    R√©sultats <span id="currentChild_rewards_results" class="current-child-inline">‚Äî</span>
  </h2>
</div>

  <!-- Historique par semaine (pour cet enfant) -->
  <section class="result-history">
    <div class="table-wrapper">
      <table>
        <thead>
          <tr>
            <th>Semaine</th>
            <th>% </th>
            <th>R√©compense</th>
          </tr>
        </thead>
        <tbody id="historiqueBody"></tbody>
      </table>
    </div>
  </section>
</main>

  <main class="view" id="vue-nom-avatar">
    <div class="view-header">
      <button onclick="openMenu()" class="back-btn">‚¨Ö Retour</button>
      <h2>Nom & Avatar</h2>
    </div>
    <div class="param-section">
      <div class="avatar-frame">
        <div class="avatar-wrapper">
          <img id="avatarPreview" src="img/default.png" alt="Avatar" class="avatar-large">
          <button type="button" class="delete-avatar-btn" onclick="deleteAvatar()">üóëÔ∏è</button>
        </div>
      </div>
      <input type="file" id="inputAvatar" accept="image/*">
      <p id="avatarFileName" class="avatar-filename">Avatar par d√©faut</p>
      <label for="inputChildName">Nom de l‚Äôenfant :</label>
      <input type="text" id="inputChildName" placeholder="Entrez le pr√©nom">
      <label for="inputChildAge">√Çge :</label>
      <input type="number" id="inputChildAge" min="0" max="20" placeholder="Entrez l‚Äô√¢ge">
      <label>Genre :</label>
      <div class="gender-options">
        <label><input type="radio" name="childGender" value="fille"> Fille</label>
        <label><input type="radio" name="childGender" value="gar√ßon"> Gar√ßon</label>
        <label><input type="radio" name="childGender" value="non-defini" checked> Non d√©fini</label>
      </div>
    </div>
    <div class="param-actions">
      <button onclick="majUI()">‚ùå Annuler</button>
    </div>
  </main>

  <main class="view" id="vue-taches">
    <div class="view-header">
      <button onclick="openMenu()" class="back-btn">‚¨Ö Retour</button>
      <h2>Gestion des t√¢ches</h2>
	  <p class="current-child" id="currentChild_tasks">‚Äî</p>
    </div>
    <div class="param-section">
      <div class="task-add">
        <input type="text" id="newTaskName" placeholder="Nouvelle t√¢che">
        <button class="save" onclick="addTask()">‚ûï Ajouter</button>
      </div>
      <ul id="taskList"></ul>
    </div>
    <div class="param-actions">
      <button onclick="majUI()">‚ùå Annuler</button>
    </div>
  </main>

  <main class="view" id="vue-recompenses">
    <div class="view-header">
      <button onclick="openMenu()" class="back-btn">‚¨Ö Retour</button>
      <h2>R√©compenses</h2>
	  <p class="current-child" id="currentChild_rewards">‚Äî</p>
    </div>
   
<!-- üîπ Paliers modifiables directement -->
<div class="reward-summary editable">
  <div class="reward-box">
    <h4>Palier 1</h4>
    <label>Seuil (%) :</label>
    <input type="number" id="summaryThreshold1" min="0" max="100" step="1">
    <label>R√©compense :</label>
    <input type="text" id="summaryReward1" placeholder="Ex : Choisir un dessin anim√©">
  </div>
  <div class="reward-box">
    <h4>Palier 2</h4>
    <label>Seuil (%) :</label>
    <input type="number" id="summaryThreshold2" min="0" max="100" step="1">
    <label>R√©compense :</label>
    <input type="text" id="summaryReward2" placeholder="Ex : Sortie au parc">
  </div>
</div>


	<!-- üîπ R√©compenses personnalis√©es -->
<div class="param-section">
  <h5>R√©compenses personnalis√©es par semaine</h5>
  <label for="customWeek">Semaine (num√©ro-ann√©e) :</label>
  <input type="text" id="customWeek" placeholder="Ex : 42-2025">

  <label for="customReward">R√©compense :</label>
  <input type="text" id="customReward" placeholder="Ex : Sortie cin√©ma">

  <label for="customPalier">Palier :</label>
  <select id="customPalier">
    <option value="Palier 1">Palier 1</option>
    <option value="Palier 2">Palier 2</option>
    <option value="-">Autre</option>
  </select>

  <button class="save" onclick="addWeeklyReward()">‚ûï Ajouter</button>
</div>

<table id="customRewardsTable">
  <thead>
    <tr><th>Semaine</th><th>R√©compense</th><th>Palier</th><th></th></tr>
  </thead>
  <tbody></tbody>
</table>

    <div class="param-actions">
      <button onclick="majUI()">‚ùå Annuler</button>
      <button class="save" onclick="saveRewards()">üíæ Enregistrer</button>
    </div>
	<div id="toast" class="toast"></div>
  </main>

  <!-- ================= JS ================= -->
  <script src="index.js"></script>

<!-- ‚úÖ V√©rification simple sans double attachement -->
<script>
window.addEventListener("load", () => {
  const resetBtn = document.getElementById("btnResetChildren");
  const purgeBtn = document.getElementById("btnPurgeAll");

  if (resetBtn) {
    console.log("‚úÖ Bouton 'R√©initialiser les enfants' d√©tect√© dans le DOM.");
  } else {
    console.warn("‚ö†Ô∏è Bouton 'R√©initialiser les enfants' introuvable.");
  }

  if (purgeBtn) {
    console.log("‚úÖ Bouton 'Purge totale' d√©tect√© dans le DOM.");
  } else {
    console.warn("‚ö†Ô∏è Bouton 'Purge totale' introuvable.");
  }
});
</script>

<script>
  function showUpdateBanner() {
    const banner = document.getElementById('updateBanner');
    const btn = document.getElementById('updateNowBtn');
    if (!banner) return;

    banner.hidden = false;
    banner.classList.add('visible');

    if (btn) {
      btn.onclick = () => {
        window.location.reload();
      };
    }
  }

  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./service-worker.js').then(reg => {
      console.log('[SW] Enregistr√© avec succ√®s.');
      reg.addEventListener('updatefound', () => {
        const newWorker = reg.installing;
        if (!newWorker) return;
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            // Le nouveau SW est d√©j√† actif gr√¢ce √† self.skipWaiting()
            // On affiche juste l'info √† l'utilisateur
            showUpdateBanner();
          }
        });
      });
    }).catch(err => console.warn('[SW] Erreur d‚Äôenregistrement :', err));
  }
</script>



<!-- üîÑ Bandeau de mise √† jour SW -->
<div id="updateBanner" class="update-banner" hidden>
  <span class="update-banner-text">
    Nouvelle version disponible üîÑ
  </span>
  <button id="updateNowBtn" type="button">
    Mettre √† jour maintenant
  </button>
</div>


</body>
</html>
